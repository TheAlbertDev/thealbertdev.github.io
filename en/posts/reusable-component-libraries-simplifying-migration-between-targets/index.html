<!DOCTYPE html><html lang="en" data-theme="light"> <head><link rel="canonical" href="https://thealbert.dev/en/posts/reusable-component-libraries-simplifying-migration-between-targets/"><meta name="robots" content="index, follow"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@thealbertdev"><meta name="twitter:creator" content="@thealbertdev"><meta name="twitter:description" content="A look at how well-designed libraries can make platform switching easier. Separating logic from specific dependencies helps keep code clean, reusable, and ready for the challenges of cross-platform development."><meta name="twitter:title" content="Reusable Component Libraries: Simplifying Migration Between Targets"><meta name="twitter:image" content="https://thealbert.dev/_astro/pexels-arturoaez220-18734769.BnFbJMmW_6d3e6.webp"><meta charset="UTF-8"><meta name="description" content="Albert √Ålvarez Carulla's personal website"><meta name="viewport" content="width=device-width"><link rel="sitemap" href="/sitemap-index.xml"><link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßëüèª‚Äçüíª</text></svg>"><title>theAlbertDev | Reusable Component Libraries: Simplifying Migration Between Targets</title><!-- Google tag (gtag.js) --><script type="text/partytown" async src="https://www.googletagmanager.com/gtag/js?id=G-11JE2P4SZ8"></script><script type="text/partytown">
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-11JE2P4SZ8');
    </script><link rel="stylesheet" href="/_astro/_about_.DQkIPkRx.css">
<style>#post-content[data-astro-cid-g3efgh6g] p[data-astro-cid-g3efgh6g]{margin:24px!important}
</style><script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.10.2 - MIT builder.io */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,d,l,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(l=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(v,1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.10.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<l.length;n++)(o=r.createElement("script")).innerHTML=l[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(d)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script></head> <body class="flex flex-col"> <div class="drawer"> <input id="my-drawer" type="checkbox" class="drawer-toggle"> <div class="drawer-content flex flex-col h-screen supports-[height:100cqh]:h-[100cqh] supports-[height:100svh]:h-[100svh]"> <div class="navbar bg-base-100 w-full fixed top-0 z-10"> <div class="flex-none md:hidden"> <label for="my-drawer" aria-label="open sidebar" class="btn btn-square btn-ghost"> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path> </svg> </label> </div> <div class="flex-1"> <a class="btn btn-ghost text-xl" href="/en"><div> <span class="font-thin">the</span><span>Albert</span><span class="font-thin">Dev</span> </div></a> </div> <div class="flex-none"> <ul class="menu menu-horizontal px-0 hidden md:flex"> <li> <a href="/en/posts">Blog</a> </li> <!-- <li>
        <a href={translatePath("/acerca-de", lang)}>{t("nav.about")}</a>
      </li>
      <li>
        <a href={translatePath("/contactar", lang)}>{t("nav.contact")}</a>
      </li> --> </ul> <div class="dropdown dropdown-end"> <div tabindex="0" role="button" class="btn btn-ghost rounded-btn"> <svg width="18" height="18" viewBox="0 0 24 24" data-icon="mdi:language">  <symbol id="ai:mdi:language"><path fill="currentColor" d="m12.87 15.07l-2.54-2.51l.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35C8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5l3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7l1.62-4.33L19.12 17z"/></symbol><use xlink:href="#ai:mdi:language"></use>  </svg> </div> <ul tabindex="0" class="menu dropdown-content bg-base-200 rounded-box z-[2] mt-4 w-52 p-2 shadow"> <li> <a href="/posts/librerias-de-componentes-reusables-simplificando-la-migracion-entre-targets"> Espa√±ol </a> </li> </ul> </div> <label class="swap swap-rotate btn btn-ghost rounded-btn"> <input id="theme-toggle" type="checkbox" class="theme-controller" value="dark"> <svg width="22" height="22" viewBox="0 0 24 24" class="swap-off" data-icon="tabler:sun">  <symbol id="ai:tabler:sun"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12a4 4 0 1 0 8 0a4 4 0 1 0-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7l-.7.7m0 11.4l.7.7m-12.1-.7l-.7.7"/></symbol><use xlink:href="#ai:tabler:sun"></use>  </svg> <svg width="22" height="22" viewBox="0 0 24 24" class="swap-on" data-icon="tabler:moon">  <symbol id="ai:tabler:moon"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"/></symbol><use xlink:href="#ai:tabler:moon"></use>  </svg> </label> <script>
  const theme = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  window.localStorage.setItem("theme", theme);

  document.getElementById("theme-toggle").checked = theme === "dark";
  document.querySelector("html").setAttribute("data-code-theme", document.getElementById("theme-toggle").checked ? "github-dark-dimmed" : "github-light");
  
  const handleToggleClick = (event) => {
    localStorage.setItem("theme", event.target.checked ? "dark" : "light");
    document.querySelector("html").setAttribute("data-code-theme", event.target.checked ? "github-dark-dimmed" : "github-light");
  };

  document
    .getElementById("theme-toggle")
    .addEventListener("click", handleToggleClick);
</script> </div> </div> <main class="flex-grow container mx-auto p-6 max-w-7xl mt-20">  <article class="container mx-auto max-w-screen-lg" data-astro-cid-g3efgh6g> <header data-astro-cid-g3efgh6g> <div class="my-14" data-astro-cid-g3efgh6g> <div class="text-sm" data-astro-cid-g3efgh6g> <span class="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent"> C Programming </span> </div> <h1 class="text-4xl font-bold mb-4" data-astro-cid-g3efgh6g> Reusable Component Libraries: Simplifying Migration Between Targets </h1> <p data-astro-cid-g3efgh6g>A look at how well-designed libraries can make platform switching easier. Separating logic from specific dependencies helps keep code clean, reusable, and ready for the challenges of cross-platform development.</p> </div> <img src="/_astro/pexels-arturoaez220-18734769.BnFbJMmW_1F27KI.webp" alt="Reusable Component Libraries: Simplifying Migration Between Targets" class="aspect-[1200/630] mx-0 w-full h-full object-cover rounded-lg overflow-hidden" data-astro-cid-g3efgh6g width="1024" height="683" loading="lazy" decoding="async"> </header> <section class="flex justify-between flex-wrap gap-x-96 pt-6 items-center" data-astro-cid-g3efgh6g> <div class="flex flex-col gap-y-1" data-astro-cid-g3efgh6g> <div class="text-sm flex justify-start items-center font-bold" data-astro-cid-g3efgh6g> <span data-astro-cid-g3efgh6g>Albert</span> </div> <div class="text-sm font-mono" data-astro-cid-g3efgh6g> December 7, 2024 | 15 minutes </div> </div> <div class="flex flex-nowrap gap-x-2 items-center"> <span>Share:</span> <ul class="menu menu-horizontal -mr-2"> <li> <a target="_blank" href="https://twitter.com/intent/tweet?text=Reusable%20Component%20Libraries%3A%20Simplifying%20Migration%20Between%20Targets&url=https%3A%2F%2Fthealbert.dev%2Fen%2Fposts%2Freusable-component-libraries-simplifying-migration-between-targets%2F"> <svg width="18" height="18" viewBox="0 0 512 512" data-icon="fa6-brands:x-twitter">  <symbol id="ai:fa6-brands:x-twitter"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2L487 464H345L233.7 318.6L106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></symbol><use xlink:href="#ai:fa6-brands:x-twitter"></use>  </svg> </a> </li><li> <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fthealbert.dev%2Fen%2Fposts%2Freusable-component-libraries-simplifying-migration-between-targets%2F&title=Reusable%20Component%20Libraries%3A%20Simplifying%20Migration%20Between%20Targets"> <svg width="18" height="18" viewBox="0 0 448 512" data-icon="fa6-brands:linkedin-in">  <symbol id="ai:fa6-brands:linkedin-in"><path fill="currentColor" d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3M447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2c-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3c94 0 111.28 61.9 111.28 142.3V448z"/></symbol><use xlink:href="#ai:fa6-brands:linkedin-in"></use>  </svg> </a> </li><li> <a target="_blank" href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fthealbert.dev%2Fen%2Fposts%2Freusable-component-libraries-simplifying-migration-between-targets%2F&p[title]=Reusable%20Component%20Libraries%3A%20Simplifying%20Migration%20Between%20Targets"> <svg width="18" height="18" viewBox="0 0 512 512" data-icon="fa6-brands:facebook">  <symbol id="ai:fa6-brands:facebook"><path fill="currentColor" d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256"/></symbol><use xlink:href="#ai:fa6-brands:facebook"></use>  </svg> </a> </li> </ul> </div> </section> <div class="divider" data-astro-cid-g3efgh6g></div> <div class="grid grid-row-2 md:gap-x-12 grid-cols-1 md:grid-cols-12 lg:grid-cols-10" data-astro-cid-g3efgh6g> <section class="article-content mb-8 prose-pre:max-w-[85vw] md:prose-pre:max-w-none prose prose-p:mb-6 prose-h2:mb-5 prose-h2:mt-10 prose-h3:mb-3 prose-h3:mt-5 col-span-1 md:col-span-8 lg:col-span-7 text-lg" data-astro-cid-g3efgh6g> <p>Operating with components external to the microcontroller or target itself is the norm in firmware development. Therefore, knowing how to develop libraries for them is essential. These libraries allow us to interact with them and exchange information or commands. However, it is not uncommon to find, in legacy code or code from students (or not-so-students), that these interactions with components are done directly in the application code or, even when placed in separate files, these interactions are intrinsically tied to the target.</p>
<p>Let‚Äôs look at a poor example of library development for a Bosch BME280 temperature, humidity, and pressure sensor in an application for an STMicroelectronics STM32F401RE. In the example, we want to initialize the component and read the temperature every 1 second. (In the example code, we will omit all the ‚Äúnoise‚Äù generated by STM32CubeMX/IDE, such as the initialization of various clocks and peripherals, or comments like <code>USER CODE BEGIN</code> or <code>USER CODE END</code>.)</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.5ullo.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame has-title"><figcaption class="header"><span class="title">main.c</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">"i2c.h"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">&#x3C;stdint.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">int</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">main</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E">  idx           </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E">  </span><span style="--0:#F69D50;--1:#AE4B07">tx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">64</span><span style="--0:#ADBAC7;--1:#24292E">] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E">  </span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">64</span><span style="--0:#ADBAC7;--1:#24292E">] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E"> dig_temp1     </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">  dig_temp2     </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">  dig_temp3     </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">  </span><span style="--0:#DCBDFB;--1:#6F42C1">MX_I2C1_Init</span><span style="--0:#ADBAC7;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">  </span><span style="--0:#F69D50;--1:#AE4B07">tx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[idx</span><span style="--0:#F5776E;--1:#BF3441">++</span><span style="--0:#ADBAC7;--1:#24292E">] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">0b</span><span style="--0:#6CB6FF;--1:#005CC5">10100011</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">  </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Write</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">77</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">F4</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                    </span></span><span style="--0:#ADBAC7;--1:#24292E">tx_buffer, </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#6CB6FF;--1:#005CC5">200</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">  </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Read</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">77</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">88</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                   </span></span><span style="--0:#ADBAC7;--1:#24292E">rx_buffer, </span><span style="--0:#6CB6FF;--1:#005CC5">6</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#6CB6FF;--1:#005CC5">200</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">|</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">              </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> (</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)(((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">2</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">|</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                        </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">3</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">));</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> (</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)(((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">|</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                        </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">5</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">));</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">while</span><span style="--0:#ADBAC7;--1:#24292E"> (</span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">   temperature </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E"> adc_temp    </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E"> t_fine      </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">   var1        </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">   var2        </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">      </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Read</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">77</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">FA</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                       </span></span><span style="--0:#ADBAC7;--1:#24292E">rx_buffer, </span><span style="--0:#6CB6FF;--1:#005CC5">3</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#6CB6FF;--1:#005CC5">200</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">adc_temp </span><span style="--0:#F5776E;--1:#BF3441">=</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">          </span></span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E">)((((</span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">12</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">|</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                    </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">|</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                    </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">2</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">>></span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">));</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">var1 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)adc_temp) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">16384.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">              </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp1) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1024.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">             </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp2);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">var2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)adc_temp) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">131072.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">               </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp1) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8192.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">              </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)adc_temp) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">131072.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">               </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp1) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8192.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">)) </span><span style="--0:#F5776E;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">             </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp3);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">t_fine </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> (</span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E">)(var1 </span><span style="--0:#F5776E;--1:#BF3441">+</span><span style="--0:#ADBAC7;--1:#24292E"> var2);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">temperature </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)t_fine) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">5129.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">      </span><span style="--0:#949EA8;--1:#616972">// Temperature available for the application.</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include &#x22;i2c.h&#x22;#include <stdint.h>int main(void){  uint8_t  idx           = 0U;  uint8_t  tx_buffer[64] = {0};  uint8_t  rx_buffer[64] = {0};  uint16_t dig_temp1     = 0U;  int16_t  dig_temp2     = 0;  int16_t  dig_temp3     = 0;  MX_I2C1_Init();  tx_buffer[idx++] = 0b10100011;  HAL_I2C_Mem_Write(&#x26;hi2c1, 0x77U << 1U, 0xF4U, 1U,                    tx_buffer, 1U, 200U);  HAL_I2C_Mem_Read(&#x26;hi2c1, 0x77U << 1U, 0x88U, 1U,                   rx_buffer, 6U, 200U);  dig_temp1 = ((uint16_t)rx_buffer[0]) |              (((uint16_t)rx_buffer[1]) << 8U);  dig_temp2 = (int16_t)(((uint16_t)rx_buffer[2]) |                        (((uint16_t)rx_buffer[3]) << 8U));  dig_temp3 = (int16_t)(((uint16_t)rx_buffer[4]) |                        (((uint16_t)rx_buffer[5]) << 8U));  while (1)  {      float   temperature = 0.0f;      int32_t adc_temp    = 0;      int32_t t_fine      = 0;      float   var1        = 0.0f;      float   var2        = 0.0f;      HAL_I2C_Mem_Read(&#x26;hi2c1, 0x77U << 1U, 0xFAU, 1U,                       rx_buffer, 3U, 200U);      adc_temp =          (int32_t)((((uint32_t)rx_buffer[0]) << 12U) |                    (((uint32_t)rx_buffer[1]) << 4U) |                    (((uint32_t)rx_buffer[2]) >> 4U));      var1 = (((float)adc_temp) / 16384.0f -              ((float)dig_temp1) / 1024.0f) *             ((float)dig_temp2);      var2 = ((((float)adc_temp) / 131072.0f -               ((float)dig_temp1) / 8192.0f) *              (((float)adc_temp) / 131072.0f -               ((float)dig_temp1) / 8192.0f)) *             ((float)dig_temp3);      t_fine = (int32_t)(var1 + var2);      temperature = ((float)t_fine) / 5129.0f;      // Temperature available for the application.  }}"><div></div></button></div></figure></div>
<p>Based on this example, we can raise a series of questions: what happens if I need to change the target (whether due to stock shortages, wanting to reduce costs, or simply working on another product that uses the same component)? What happens if I have more than one component of the same type in the system? What happens if another product uses the same component? How can I test my development if I don‚Äôt have the hardware yet (a very common situation in the professional world where firmware and hardware development phases often overlap at certain points in the process)?</p>
<p>For the first three questions, the answer is to edit the code, whether to completely change it when switching targets, to duplicate the existing code to operate with an additional component of the same type, or to implement the same code for the other project/product. In the last question, there is no way to test the code without having the hardware to execute it. This means that only after the hardware is finished could we begin testing our code and start fixing errors inherent to firmware development itself, thus prolonging the product development time. This raises the question that gives rise to this post: is it possible to develop libraries for components that are independent of the target and allow for reuse? The answer is yes, and this is what we will see in this post.</p>
<section class="heading" data-heading-rank="2"><h2 id="isolating-the-library-from-the-target">Isolating the Library from the Target</h2>
<p>To isolate libraries from a target, we will follow two rules: 1) we will implement the library in its own compilation unit, meaning its own file, and 2) there will be no references to any target-specific headers or functions. We will demonstrate this by implementing a simple library for the BME280. To start, we will create a folder called <code>bme280</code> within our project. Inside the <code>bme280</code> folder, we will create the following files: <code>bme280.c</code>, <code>bme280.h</code>, and <code>bme280_interface.h</code>. To clarify, no, I haven‚Äôt forgotten to name the file <code>bme280_interface.c</code>. This file will not be part of the library.</p>
<div class="chat chat-start"><div class="chat-image avatar"><div class="w-10 rounded-full"><img src="/_astro/albert-pic-profile.CD782flh_2oILFe.webp" alt="Albert" class="m-0" width="40" height="40" loading="lazy" decoding="async"></div></div><div class="chat-bubble">I usually place the library folders inside <code>Application/lib/</code>.</div></div>
<p>The <code>bme280.h</code> file will declare all the functions available in our library to be called by our application. On the other hand, the <code>bme280.c</code> file will implement the definitions of those functions, along with any auxiliary and private functions that the library may contain. So, what does the <code>bme280_interface.h</code> file contain? Well, our target, whatever it may be, will need to communicate with the BME280 component in one way or another. In this case, the BME280 supports either SPI or I2C communication. In both cases, the target must be able to read and write bytes to the component. The <code>bme280_interface.h</code> file will declare those functions so they can be called from the library. The definition of these functions will be the only part tied to the specific target, and it will be the only thing we need to edit if we migrate the library to another target.</p>
</section><section class="heading" data-heading-rank="2"><h2 id="declaring-the-library-api">Declaring the Library API</h2>
<p>We begin by declaring the available functions in the library within the <code>bme280.h</code> file.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.h</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#ifndef</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_H_</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_H_</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">  </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_init</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_get_temperature</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#endif</span><span style="--0:#949EA8;--1:#616972"> // BME280_H_</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#ifndef BME280_H_#define BME280_H_void  BME280_init(void);float BME280_get_temperature(void);#endif // BME280_H_"><div></div></button></div></figure></div>
<p>The library we are creating will be very simple, and we will only implement a basic initialization function and another to obtain a temperature measurement. Now, let‚Äôs implement the functions in the <code>bme280.c</code> file.</p>
<div class="chat chat-start"><div class="chat-image avatar"><div class="w-10 rounded-full"><img src="/_astro/albert-pic-profile.CD782flh_2oILFe.webp" alt="Albert" class="m-0" width="40" height="40" loading="lazy" decoding="async"></div></div><div class="chat-bubble">To avoid making the post too <i>verbose</i>, I am skipping the comments that would document the functions.</div></div><div class="chat chat-start"><div class="chat-image avatar"><div class="w-10 rounded-full"><img src="/_astro/albert-pic-profile.CD782flh_2oILFe.webp" alt="Albert" class="m-0" width="40" height="40" loading="lazy" decoding="async"></div></div><div class="chat-bubble">This is the file where those comments would go.</div></div><div class="chat chat-start"><div class="chat-image avatar"><div class="w-10 rounded-full"><img src="/_astro/albert-pic-profile.CD782flh_2oILFe.webp" alt="Albert" class="m-0" width="40" height="40" loading="lazy" decoding="async"></div></div><div class="chat-bubble">With so many AI tools available today, there‚Äôs no excuse for not documenting your code.</div></div>
</section><section class="heading" data-heading-rank="2"><h2 id="implementation-of-the-driver-api">Implementation of the Driver API</h2>
<p>The skeleton of the <code>bme280.c</code> file would be as follows:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.c</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_init</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_get_temperature</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void BME280_init(void){}float BME280_get_temperature(void){}"><div></div></button></div></figure></div>
<p>Let‚Äôs focus on initialization. As mentioned earlier, the BME280 supports both I2C and SPI communication. In both cases, we need to initialize the appropriate peripheral of the target (I2C or SPI), and then we need to be able to send and receive bytes through them. Assuming we are using I2C communication, in the STM32F401RE it would be:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.c</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_init</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#DCBDFB;--1:#6F42C1">MX_I2C1_Init</span><span style="--0:#ADBAC7;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void BME280_init(void){  MX_I2C1_Init();}"><div></div></button></div></figure></div>
<p>Once the peripheral is initialized, we need to initialize the component. Here, we must use the information provided by the manufacturer in its <a href="https://www.bosch-sensortec.com/products/environmental-sensors/humidity-sensors-bme280/" target="_blank">datasheet</a>. Here‚Äôs a quick summary: we need to start the temperature sampling channel (which is in sleep mode by default) and read some calibration constants stored in the component‚Äôs ROM, which we will need later to calculate the temperature.</p>
<div class="chat chat-start"><div class="chat-image avatar"><div class="w-10 rounded-full"><img src="/_astro/albert-pic-profile.CD782flh_2oILFe.webp" alt="Albert" class="m-0" width="40" height="40" loading="lazy" decoding="async"></div></div><div class="chat-bubble">The goal of this post is not to learn how to use the BME280, so I will skip details of its usage, which you can find in its datasheet.</div></div>
<p>The initialization would look like this:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.c</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">"i2c.h"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">&#x3C;stdint.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_TX_BUFFER_SIZE</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">32</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_RX_BUFFER_SIZE</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">32</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_TIMEOUT</span><span style="--0:#ADBAC7;--1:#24292E">        </span><span style="--0:#6CB6FF;--1:#005CC5">200</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_ADDRESS</span><span style="--0:#ADBAC7;--1:#24292E">        </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">77</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_REG_CTRL_MEAS</span><span style="--0:#ADBAC7;--1:#24292E">  </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">F4</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_REG_DIG_T</span><span style="--0:#ADBAC7;--1:#24292E">      </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">88</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">static</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E"> dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">static</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">  dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">static</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">  dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_init</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> idx                              </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">tx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[BME280_TX_BUFFER_SIZE] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[BME280_RX_BUFFER_SIZE] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">HAL_StatusTypeDef status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_ERROR;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">  </span><span style="--0:#DCBDFB;--1:#6F42C1">MX_I2C1_Init</span><span style="--0:#ADBAC7;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">  </span><span style="--0:#F69D50;--1:#AE4B07">tx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[idx</span><span style="--0:#F5776E;--1:#BF3441">++</span><span style="--0:#ADBAC7;--1:#24292E">] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">0b</span><span style="--0:#6CB6FF;--1:#005CC5">10100011</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Write</span><span style="--0:#ADBAC7;--1:#24292E">(</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, BME280_ADDRESS </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, BME280_REG_CTRL_MEAS,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">      </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, tx_buffer, (</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)idx, BME280_TIMEOUT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_OK)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Read</span><span style="--0:#ADBAC7;--1:#24292E">(</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, BME280_ADDRESS </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, BME280_REG_DIG_T, </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">rx_buffer, </span><span style="--0:#6CB6FF;--1:#005CC5">6</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, BME280_TIMEOUT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_OK)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">=</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">|</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">2</span><span style="--0:#ADBAC7;--1:#24292E">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">|</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">3</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#ADBAC7;--1:#24292E">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">|</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">5</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include &#x22;i2c.h&#x22;#include <stdint.h>#define BME280_TX_BUFFER_SIZE 32U#define BME280_RX_BUFFER_SIZE 32U#define BME280_TIMEOUT        200U#define BME280_ADDRESS        0x77U#define BME280_REG_CTRL_MEAS  0xF4U#define BME280_REG_DIG_T      0x88Ustatic uint16_t dig_temp1 = 0U;static int16_t  dig_temp2 = 0;static int16_t  dig_temp3 = 0;void BME280_init(void){  uint8_t idx                              = 0U;  uint8_t tx_buffer[BME280_TX_BUFFER_SIZE] = {0};  uint8_t rx_buffer[BME280_RX_BUFFER_SIZE] = {0};  HAL_StatusTypeDef status = HAL_ERROR;  MX_I2C1_Init();  tx_buffer[idx++] = 0b10100011;  status = HAL_I2C_Mem_Write(      &#x26;hi2c1, BME280_ADDRESS << 1U, BME280_REG_CTRL_MEAS,      1U, tx_buffer, (uint16_t)idx, BME280_TIMEOUT);  if (status != HAL_OK)      return;  status = HAL_I2C_Mem_Read(      &#x26;hi2c1, BME280_ADDRESS << 1U, BME280_REG_DIG_T, 1U,      rx_buffer, 6U, BME280_TIMEOUT);  if (status != HAL_OK)      return;  dig_temp1 = ((uint16_t)rx_buffer[0]);  dig_temp1 =      dig_temp1 | (((uint16_t)rx_buffer[1]) << 8U);  dig_temp2 = ((int16_t)rx_buffer[2]);  dig_temp2 = dig_temp2 | (((int16_t)rx_buffer[3]) << 8U);  dig_temp3 = ((int16_t)rx_buffer[4]);  dig_temp3 = dig_temp3 | (((int16_t)rx_buffer[5]) << 8U);  return;}"><div></div></button></div></figure></div>
<p>Details to comment on. The calibration values that we read are stored in variables called <code>dig_temp1</code>, <code>dig_temp2</code>, and <code>dig_temp3</code>. These variables are declared as global so they are available for the rest of the functions in the library. However, they are declared as static so that they are only accessible within the library. No one outside the library needs to access or modify these values.</p>
<p>We also see that the return value from the I2C instructions is checked, and in case of a failure, the function execution is halted. This is fine, but it can be improved. Wouldn‚Äôt it be better to notify the caller of the <code>BME280_init</code> function that something went wrong, if that was the case? To do this, we define the following <code>enum</code> in the <code>bme280.h</code> file.</p>
<div class="chat chat-start"><div class="chat-image avatar"><div class="w-10 rounded-full"><img src="/_astro/albert-pic-profile.CD782flh_2oILFe.webp" alt="Albert" class="m-0" width="40" height="40" loading="lazy" decoding="async"></div></div><div class="chat-bubble">I use <code>typedef</code> for them.</div></div><div class="chat chat-start"><div class="chat-image avatar"><div class="w-10 rounded-full"><img src="/_astro/albert-pic-profile.CD782flh_2oILFe.webp" alt="Albert" class="m-0" width="40" height="40" loading="lazy" decoding="async"></div></div><div class="chat-bubble">There is debate about the use of <code>typedef</code> because they improve code readability at the cost of hiding details.</div></div><div class="chat chat-start"><div class="chat-image avatar"><div class="w-10 rounded-full"><img src="/_astro/albert-pic-profile.CD782flh_2oILFe.webp" alt="Albert" class="m-0" width="40" height="40" loading="lazy" decoding="async"></div></div><div class="chat-bubble">It‚Äôs a matter of personal preference and making sure all members of the development team are on the same page.</div></div>
<br/>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.h</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">typedef</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">enum</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">BME280_Status_Ok,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">BME280_Status_Status_Err,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">} </span><span style="--0:#6CB6FF;--1:#005CC5">BME280_Status_t</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="typedef enum{  BME280_Status_Ok,  BME280_Status_Status_Err,} BME280_Status_t;"><div></div></button></div></figure></div>
<p>Two notes: I usually add the <code>_t</code> suffix to typedefs to indicate that they are typedefs, and I add the typedef prefix to the values or members of the typedef, in this case <code>BME280_Status_</code>. The latter is to avoid collisions between enums from different libraries. If everyone used <code>OK</code> as an enum, we‚Äôd be in trouble.</p>
<p>Now we can modify both the declaration (<code>bme280.h</code>) and the definition (<code>bme280.c</code>) of the <code>BME280_init</code> function to return a status. The final version of our function would be:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.h</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Status_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_init</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="BME280_Status_t BME280_init(void);"><div></div></button></div></figure></div>
<br/>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.c</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">"bme280.h"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Status_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_init</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> idx                              </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">tx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[BME280_TX_BUFFER_SIZE] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[BME280_RX_BUFFER_SIZE] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">HAL_StatusTypeDef status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_ERROR;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#DCBDFB;--1:#6F42C1">MX_I2C1_Init</span><span style="--0:#ADBAC7;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">  </span><span style="--0:#F69D50;--1:#AE4B07">tx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[idx</span><span style="--0:#F5776E;--1:#BF3441">++</span><span style="--0:#ADBAC7;--1:#24292E">] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">0b</span><span style="--0:#6CB6FF;--1:#005CC5">10100011</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Write</span><span style="--0:#ADBAC7;--1:#24292E">(</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, BME280_ADDRESS </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, BME280_REG_CTRL_MEAS,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">      </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, tx_buffer, (</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)idx, BME280_TIMEOUT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_OK)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Read</span><span style="--0:#ADBAC7;--1:#24292E">(</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, BME280_ADDRESS </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, BME280_REG_DIG_T, </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">rx_buffer, </span><span style="--0:#6CB6FF;--1:#005CC5">6</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, BME280_TIMEOUT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_OK)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">=</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">|</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">2</span><span style="--0:#ADBAC7;--1:#24292E">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">|</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">3</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#ADBAC7;--1:#24292E">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">|</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">5</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME_Status_Ok;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include &#x22;bme280.h&#x22;BME280_Status_t BME280_init(void){  uint8_t idx                              = 0U;  uint8_t tx_buffer[BME280_TX_BUFFER_SIZE] = {0};  uint8_t rx_buffer[BME280_RX_BUFFER_SIZE] = {0};  HAL_StatusTypeDef status = HAL_ERROR;  MX_I2C1_Init();  tx_buffer[idx++] = 0b10100011;  status = HAL_I2C_Mem_Write(      &#x26;hi2c1, BME280_ADDRESS << 1U, BME280_REG_CTRL_MEAS,      1U, tx_buffer, (uint16_t)idx, BME280_TIMEOUT);  if (status != HAL_OK)      return BME280_Status_Err;  status = HAL_I2C_Mem_Read(      &#x26;hi2c1, BME280_ADDRESS << 1U, BME280_REG_DIG_T, 1U,      rx_buffer, 6U, BME280_TIMEOUT);  if (status != HAL_OK)      return BME280_Status_Err;  dig_temp1 = ((uint16_t)rx_buffer[0]);  dig_temp1 =      dig_temp1 | (((uint16_t)rx_buffer[1]) << 8U);  dig_temp2 = ((int16_t)rx_buffer[2]);  dig_temp2 = dig_temp2 | (((int16_t)rx_buffer[3]) << 8U);  dig_temp3 = ((int16_t)rx_buffer[4]);  dig_temp3 = dig_temp3 | (((int16_t)rx_buffer[5]) << 8U);  return BME_Status_Ok;}"><div></div></button></div></figure></div>
<p>Since we are using the status enum, we must include the <code>bme280.h</code> file in the <code>bme280.c</code> file. We have already initialized the library. Now, let‚Äôs create the function to retrieve the temperature. It would look like this:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.c</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_REG_TEMP</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">FA</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Status_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_get_temperature</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#F69D50;--1:#AE4B07">temperature</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[BME280_RX_BUFFER_SIZE] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E"> adc_temp                         </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E"> t_fine                           </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">   var1                             </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">   var2                             </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">HAL_StatusTypeDef status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_ERROR;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#ADBAC7;--1:#24292E">temperature </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Read</span><span style="--0:#ADBAC7;--1:#24292E">(</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, BME280_ADDRESS </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, BME280_REG_TEMP, </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">rx_buffer, </span><span style="--0:#6CB6FF;--1:#005CC5">3</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, BME280_TIMEOUT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_OK)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">adc_temp </span><span style="--0:#F5776E;--1:#BF3441">=</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">        </span></span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E">)((((</span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">12</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">|</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                  </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">|</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                  </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">2</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">>></span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">));</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">var1 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)adc_temp) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">16384.0</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">          </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp1) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1024.0</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">         </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp2);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">var2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)adc_temp) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">131072.0</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">           </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp1) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8192.0</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">          </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)adc_temp) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">131072.0</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">           </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp1) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8192.0</span><span style="--0:#ADBAC7;--1:#24292E">)) </span><span style="--0:#F5776E;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">         </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp3);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">t_fine </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> (</span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E">)(var1 </span><span style="--0:#F5776E;--1:#BF3441">+</span><span style="--0:#ADBAC7;--1:#24292E"> var2);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#ADBAC7;--1:#24292E">temperature </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)t_fine) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">5129.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Ok;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#define BME280_REG_TEMP 0xFAUBME280_Status_t BME280_get_temperature(float *temperature){  uint8_t rx_buffer[BME280_RX_BUFFER_SIZE] = {0};  int32_t adc_temp                         = 0;  int32_t t_fine                           = 0;  float   var1                             = 0.0f;  float   var2                             = 0.0f;  HAL_StatusTypeDef status = HAL_ERROR;  *temperature = 0.0f;  status = HAL_I2C_Mem_Read(      &#x26;hi2c1, BME280_ADDRESS << 1U, BME280_REG_TEMP, 1U,      rx_buffer, 3U, BME280_TIMEOUT);  if (status != HAL_OK)      return BME280_Status_Err;  adc_temp =        (int32_t)((((uint32_t)rx_buffer[0]) << 12U) |                  (((uint32_t)rx_buffer[1]) << 4U) |                  (((uint32_t)rx_buffer[2]) >> 4U));  var1 = (((float)adc_temp) / 16384.0 -          ((float)dig_temp1) / 1024.0) *         ((float)dig_temp2);  var2 = ((((float)adc_temp) / 131072.0 -           ((float)dig_temp1) / 8192.0) *          (((float)adc_temp) / 131072.0 -           ((float)dig_temp1) / 8192.0)) *         ((float)dig_temp3);  t_fine = (int32_t)(var1 + var2);  *temperature = ((float)t_fine) / 5129.0f;  return BME280_Status_Ok;}"><div></div></button></div></figure></div>
<p>You‚Äôve noticed, right? We‚Äôve modified the function signature so that it returns a status to indicate whether there were communication issues with the component or not, and the result is returned through the pointer passed as a parameter to the function. If you‚Äôre following the example, remember to modify the function declaration in the <code>bme280.h</code> file so that they match.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.h</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Status_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_get_temperature</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#F69D50;--1:#AE4B07">temperature</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="BME280_Status_t BME280_get_temperature(float *temperature);"><div></div></button></div></figure></div>
<p>Great! At this point, in the application we can have:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">main.c</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">"bme280.h"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">int</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">main</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">  </span><span style="--0:#6CB6FF;--1:#005CC5">BME280_Status_t</span><span style="--0:#ADBAC7;--1:#24292E"> status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_init</span><span style="--0:#ADBAC7;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Ok)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">      </span><span style="--0:#DCBDFB;--1:#6F42C1">Error_Handler</span><span style="--0:#ADBAC7;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">while</span><span style="--0:#ADBAC7;--1:#24292E"> (</span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E"> temperature </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_get_temperature</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">temperature);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Ok)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">          </span><span style="--0:#DCBDFB;--1:#6F42C1">Error_Handler</span><span style="--0:#ADBAC7;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">      </span><span style="--0:#949EA8;--1:#616972">// Temperature available for the application.</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include &#x22;bme280.h&#x22;int main(void){  BME280_Status_t status = BME280_Status_Err;  status = BME280_init();  if (status != BME280_Status_Ok)      Error_Handler();  while (1)  {      float temperature = 0.0f;      status = BME280_get_temperature(&#x26;temperature);      if (status != BME280_Status_Ok)          Error_Handler();      // Temperature available for the application.  }}"><div></div></button></div></figure></div>
<p>Super clean! This is readable. Ignore the use of the <code>Error_Handler</code> function from STM32CubeMX/IDE. It‚Äôs generally not recommended to use it, but for the example, it works for us. So, is it done?</p>
<p>Well, no! We‚Äôve encapsulated our interactions with the component into its own files. But its code is still calling target functions (HAL functions)! If we change the target, we‚Äôll have to rewrite the library! Hint: we haven‚Äôt written anything in the <code>bme280_interface.h</code> file yet. Let‚Äôs tackle that now.</p>
</section><section class="heading" data-heading-rank="2"><h2 id="interface-declaration">Interface Declaration</h2>
<p>If we look at the <code>bme280.c</code> file, our interactions with the target are threefold: to initialize peripherals, to write/send bytes, and to read/receive bytes. So, what we‚Äôll do is declare those three interactions in the <code>bme280_interface.h</code> file.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280_interface.h</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#ifndef</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_INTERFACE_H_</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_INTERFACE_H_</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">&#x3C;stdint.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">typedef</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">enum</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">BME280_Interface_Ok,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">BME280_Interface_Err,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">} </span><span style="--0:#6CB6FF;--1:#005CC5">BME280_Interface_Status_t</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Interface_Status_t</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_init</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">address</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">timeout</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Interface_Status_t</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_write</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">reg</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#F69D50;--1:#AE4B07">data</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">                     </span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">size</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Interface_Status_t</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_read</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">reg</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#F69D50;--1:#AE4B07">data</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">size</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#endif</span><span style="--0:#949EA8;--1:#616972"> // BME280*INTERFACE_H_</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#ifndef BME280_INTERFACE_H_#define BME280_INTERFACE_H_#include <stdint.h>typedef enum{  BME280_Interface_Ok,  BME280_Interface_Err,} BME280_Interface_Status_t;BME280_Interface_Status_tBME280_Interface_init(uint8_t address, uint32_t timeout);BME280_Interface_Status_tBME280_Interface_write(uint8_t reg, uint8_t *data,                     uint16_t size);BME280_Interface_Status_tBME280_Interface_read(uint8_t reg, uint8_t *data,                    uint16_t size);#endif // BME280*INTERFACE_H_"><div></div></button></div></figure></div>
<p>If you notice, we‚Äôve also defined a new type for the interface status. Now, instead of calling the target functions directly, we will call these functions from the <code>bme280.c</code> file.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280.c</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">"bme280.h"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">"bme280_interface.h"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_TX_BUFFER_SIZE</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">32</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_RX_BUFFER_SIZE</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">32</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_TIMEOUT</span><span style="--0:#ADBAC7;--1:#24292E">        </span><span style="--0:#6CB6FF;--1:#005CC5">200</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_ADDRESS</span><span style="--0:#ADBAC7;--1:#24292E">        </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">77</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_REG_CTRL_MEAS</span><span style="--0:#ADBAC7;--1:#24292E">  </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">F4</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_REG_DIG_T</span><span style="--0:#ADBAC7;--1:#24292E">      </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">88</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#define</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_REG_TEMP</span><span style="--0:#ADBAC7;--1:#24292E">       </span><span style="--0:#F5776E;--1:#BF3441">0x</span><span style="--0:#6CB6FF;--1:#005CC5">FA</span><span style="--0:#F5776E;--1:#BF3441">U</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">static</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E"> dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">static</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">  dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">static</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">  dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Status_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_init</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">void</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> idx                              </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">tx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[BME280_TX_BUFFER_SIZE] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[BME280_RX_BUFFER_SIZE] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">  </span><span style="--0:#6CB6FF;--1:#005CC5">BME280_Interface_Status_t</span><span style="--0:#ADBAC7;--1:#24292E"> status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_init</span><span style="--0:#ADBAC7;--1:#24292E">(BME280_ADDRESS,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                                 </span></span><span style="--0:#ADBAC7;--1:#24292E">BME280_TIMEOUT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Ok)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">  </span><span style="--0:#F69D50;--1:#AE4B07">tx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[idx</span><span style="--0:#F5776E;--1:#BF3441">++</span><span style="--0:#ADBAC7;--1:#24292E">] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">0b</span><span style="--0:#6CB6FF;--1:#005CC5">10100011</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_write</span><span style="--0:#ADBAC7;--1:#24292E">(</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">BME280_REG_CTRL_MEAS, tx_buffer, (</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Ok)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_read</span><span style="--0:#ADBAC7;--1:#24292E">(BME280_REG_DIG_T,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                                 </span></span><span style="--0:#ADBAC7;--1:#24292E">rx_buffer, </span><span style="--0:#6CB6FF;--1:#005CC5">6</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Ok)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">=</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp1 </span><span style="--0:#F5776E;--1:#BF3441">|</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">2</span><span style="--0:#ADBAC7;--1:#24292E">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> dig_temp2 </span><span style="--0:#F5776E;--1:#BF3441">|</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">3</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#ADBAC7;--1:#24292E">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> dig_temp3 </span><span style="--0:#F5776E;--1:#BF3441">|</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">int16_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">5</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Ok;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Status_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_get_temperature</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#F69D50;--1:#AE4B07">temperature</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[BME280_RX_BUFFER_SIZE] </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> {</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E"> adc_temp                         </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E"> t_fine                           </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">  var1                             </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">  var2                             </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">  </span><span style="--0:#6CB6FF;--1:#005CC5">BME280_Interface_Status_t</span><span style="--0:#ADBAC7;--1:#24292E"> status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#ADBAC7;--1:#24292E">temperature </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_read</span><span style="--0:#ADBAC7;--1:#24292E">(BME280_REG_TEMP,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                                 </span></span><span style="--0:#ADBAC7;--1:#24292E">rx_buffer, </span><span style="--0:#6CB6FF;--1:#005CC5">3</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Ok)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">adc_temp </span><span style="--0:#F5776E;--1:#BF3441">=</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">      </span></span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E">)((((</span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">12</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">|</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">|</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">                </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E">)</span><span style="--0:#F69D50;--1:#AE4B07">rx_buffer</span><span style="--0:#ADBAC7;--1:#24292E">[</span><span style="--0:#6CB6FF;--1:#005CC5">2</span><span style="--0:#ADBAC7;--1:#24292E">]) </span><span style="--0:#F5776E;--1:#BF3441">>></span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">4</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">));</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">var1 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> (((</span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">)adc_temp) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">16384.0</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">          </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp1) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1024.0</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">         </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp2);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">var2 </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((((</span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">)adc_temp) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">131072.0</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">           </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp1) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8192.0</span><span style="--0:#ADBAC7;--1:#24292E">) </span><span style="--0:#F5776E;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">          </span></span><span style="--0:#ADBAC7;--1:#24292E">(((</span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">)adc_temp) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">131072.0</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">-</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">           </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp1) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">8192.0</span><span style="--0:#ADBAC7;--1:#24292E">)) </span><span style="--0:#F5776E;--1:#BF3441">*</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">         </span></span><span style="--0:#ADBAC7;--1:#24292E">((</span><span style="--0:#F5776E;--1:#BF3441">double</span><span style="--0:#ADBAC7;--1:#24292E">)dig_temp3);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">t_fine </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> (</span><span style="--0:#F5776E;--1:#BF3441">int32_t</span><span style="--0:#ADBAC7;--1:#24292E">)(var1 </span><span style="--0:#F5776E;--1:#BF3441">+</span><span style="--0:#ADBAC7;--1:#24292E"> var2);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#ADBAC7;--1:#24292E">temperature </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> ((</span><span style="--0:#F5776E;--1:#BF3441">float</span><span style="--0:#ADBAC7;--1:#24292E">)t_fine) </span><span style="--0:#F5776E;--1:#BF3441">/</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">5129.0</span><span style="--0:#F5776E;--1:#BF3441">f</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Status_Ok;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include &#x22;bme280.h&#x22;#include &#x22;bme280_interface.h&#x22;#define BME280_TX_BUFFER_SIZE 32U#define BME280_RX_BUFFER_SIZE 32U#define BME280_TIMEOUT        200U#define BME280_ADDRESS        0x77U#define BME280_REG_CTRL_MEAS  0xF4U#define BME280_REG_DIG_T      0x88U#define BME280_REG_TEMP       0xFAUstatic uint16_t dig_temp1 = 0U;static int16_t  dig_temp2 = 0;static int16_t  dig_temp3 = 0;BME280_Status_t BME280_init(void){  uint8_t idx                              = 0U;  uint8_t tx_buffer[BME280_TX_BUFFER_SIZE] = {0};  uint8_t rx_buffer[BME280_RX_BUFFER_SIZE] = {0};  BME280_Interface_Status_t status = BME280_Interface_Err;  status = BME280_Interface_init(BME280_ADDRESS,                                 BME280_TIMEOUT);  if (status != BME280_Interface_Ok)      return BME280_Status_Err;  tx_buffer[idx++] = 0b10100011;  status = BME280_Interface_write(      BME280_REG_CTRL_MEAS, tx_buffer, (uint16_t)idx);  if (status != BME280_Interface_Ok)      return BME280_Status_Err;  status = BME280_Interface_read(BME280_REG_DIG_T,                                 rx_buffer, 6U);  if (status != BME280_Interface_Ok)      return BME280_Status_Err;  dig_temp1 = ((uint16_t)rx_buffer[0]);  dig_temp1 =      dig_temp1 | (((uint16_t)rx_buffer[1]) << 8U);  dig_temp2 = ((int16_t)rx_buffer[2]);  dig_temp2 = dig_temp2 | (((int16_t)rx_buffer[3]) << 8U);  dig_temp3 = ((int16_t)rx_buffer[4]);  dig_temp3 = dig_temp3 | (((int16_t)rx_buffer[5]) << 8U);  return BME280_Status_Ok;}BME280_Status_t BME280_get_temperature(float *temperature){  uint8_t rx_buffer[BME280_RX_BUFFER_SIZE] = {0};  int32_t adc_temp                         = 0;  int32_t t_fine                           = 0;  double  var1                             = 0.0;  double  var2                             = 0.0;  BME280_Interface_Status_t status = BME280_Interface_Err;  *temperature = 0.0f;  status = BME280_Interface_read(BME280_REG_TEMP,                                 rx_buffer, 3U);  if (status != BME280_Interface_Ok)      return BME280_Status_Err;  adc_temp =      (int32_t)((((uint32_t)rx_buffer[0]) << 12U) |                (((uint32_t)rx_buffer[1]) << 4U) |                (((uint32_t)rx_buffer[2]) >> 4U));  var1 = (((double)adc_temp) / 16384.0 -          ((double)dig_temp1) / 1024.0) *         ((double)dig_temp2);  var2 = ((((double)adc_temp) / 131072.0 -           ((double)dig_temp1) / 8192.0) *          (((double)adc_temp) / 131072.0 -           ((double)dig_temp1) / 8192.0)) *         ((double)dig_temp3);  t_fine = (int32_t)(var1 + var2);  *temperature = ((float)t_fine) / 5129.0f;  return BME280_Status_Ok;}"><div></div></button></div></figure></div>
<p><em>Et voil√†!</em> The target dependencies have disappeared from the library. We now have a library that works for STM32, MSP430, PIC32, etc. In the three library files, nothing specific to any target should appear. What‚Äôs the only thing left? Well, defining the interface functions. This is the only part that needs to be migrated/adapted for each target.</p>
<div class="chat chat-start"><div class="chat-image avatar"><div class="w-10 rounded-full"><img src="/_astro/albert-pic-profile.CD782flh_2oILFe.webp" alt="Albert" class="m-0" width="40" height="40" loading="lazy" decoding="async"></div></div><div class="chat-bubble">I usually do it inside the folder <code>Application/bsp/components/</code>.</div></div>
<p>We create a file called <code>bme280_implementation.c</code> with the following content:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">bme280_implementation.c</span></figcaption><pre data-language="c"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">"bme280_interface.h"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">#include</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#96D0FF;--1:#032F62">"i2c.h"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">static</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E">  device_address </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#F5776E;--1:#BF3441">static</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E"> device_timeout </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">0</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Interface_Status_t</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_init</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">address</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#F5776E;--1:#BF3441">uint32_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">timeout</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#DCBDFB;--1:#6F42C1">MX_I2C1_Init</span><span style="--0:#ADBAC7;--1:#24292E">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">device_address </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> address;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">device_timeout </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> timeout;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Ok;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Interface_Status_t</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_write</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">reg</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#F69D50;--1:#AE4B07">data</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">                     </span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">size</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">HAL_StatusTypeDef status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_ERROR;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">      </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Write</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, device_address </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, reg,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">                        </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, data, size, device_timeout);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_OK)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Ok;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span style="--0:#6CB6FF;--1:#005CC5">BME280_Interface_Status_t</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span style="--0:#DCBDFB;--1:#6F42C1">BME280_Interface_read</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">reg</span><span style="--0:#ADBAC7;--1:#24292E">, </span><span style="--0:#F5776E;--1:#BF3441">uint8_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F5776E;--1:#BF3441">*</span><span style="--0:#F69D50;--1:#AE4B07">data</span><span style="--0:#ADBAC7;--1:#24292E">,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">                    </span><span style="--0:#F5776E;--1:#BF3441">uint16_t</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#F69D50;--1:#AE4B07">size</span><span style="--0:#ADBAC7;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">{</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">HAL_StatusTypeDef status </span><span style="--0:#F5776E;--1:#BF3441">=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_ERROR;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#ADBAC7;--1:#24292E">  </span></span><span style="--0:#ADBAC7;--1:#24292E">status </span><span style="--0:#F5776E;--1:#BF3441">=</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">      </span><span style="--0:#DCBDFB;--1:#6F42C1">HAL_I2C_Mem_Read</span><span style="--0:#ADBAC7;--1:#24292E">(</span><span style="--0:#F5776E;--1:#BF3441">&#x26;</span><span style="--0:#ADBAC7;--1:#24292E">hi2c1, device_address </span><span style="--0:#F5776E;--1:#BF3441">&#x3C;&#x3C;</span><span style="--0:#ADBAC7;--1:#24292E"> </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, reg,</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">                       </span><span style="--0:#6CB6FF;--1:#005CC5">1</span><span style="--0:#F5776E;--1:#BF3441">U</span><span style="--0:#ADBAC7;--1:#24292E">, data, size, device_timeout);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">if</span><span style="--0:#ADBAC7;--1:#24292E"> (status </span><span style="--0:#F5776E;--1:#BF3441">!=</span><span style="--0:#ADBAC7;--1:#24292E"> HAL_OK)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">      </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Err;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">  </span><span style="--0:#F5776E;--1:#BF3441">return</span><span style="--0:#ADBAC7;--1:#24292E"> BME280_Interface_Ok;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span style="--0:#ADBAC7;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include &#x22;bme280_interface.h&#x22;#include &#x22;i2c.h&#x22;static uint8_t  device_address = 0U;static uint32_t device_timeout = 0U;BME280_Interface_Status_tBME280_Interface_init(uint8_t address, uint32_t timeout){  MX_I2C1_Init();  device_address = address;  device_timeout = timeout;  return BME280_Interface_Ok;}BME280_Interface_Status_tBME280_Interface_write(uint8_t reg, uint8_t *data,                     uint16_t size){  HAL_StatusTypeDef status = HAL_ERROR;  status =      HAL_I2C_Mem_Write(&#x26;hi2c1, device_address << 1U, reg,                        1U, data, size, device_timeout);  if (status != HAL_OK)      return BME280_Interface_Err;  return BME280_Interface_Ok;}BME280_Interface_Status_tBME280_Interface_read(uint8_t reg, uint8_t *data,                    uint16_t size){  HAL_StatusTypeDef status = HAL_ERROR;  status =      HAL_I2C_Mem_Read(&#x26;hi2c1, device_address << 1U, reg,                       1U, data, size, device_timeout);  if (status != HAL_OK)      return BME280_Interface_Err;  return BME280_Interface_Ok;}"><div></div></button></div></figure></div>
<p>This way, if we want to use the library in another project or on another target, we only need to adapt the <code>bme280_implementation.c</code> file. The rest remains exactly the same.</p>
</section><section class="heading" data-heading-rank="2"><h2 id="other-aspects-to-consider">Other aspects to consider</h2>
<p>With this, we have seen a basic example of a library. This implementation is the simplest, safest, and most common. However, there are different variants depending on the characteristics of our project. In this example, we have seen how to perform a selection of the implementation at link time. That is, we have the <code>bme280_implementation.c</code> file, which provides the definitions of the interface functions during the compilation/linking process. What would happen if we wanted to have two implementations? One for I2C communication and another for SPI communication. In that case, we would need to specify the implementations at run time using function pointers.</p>
<p>Another aspect is that in this example, we assume there is only one BME280 in the system. What would happen if we had more than one? Should we copy/paste code and add prefixes to functions like <code>BME280_1</code> and <code>BME280_2</code>? No. That‚Äôs not ideal. What we would do is use handlers to allow us to operate with the same library on different instances of a component.</p>
<p>These aspects and how to test our library before even having our hardware available is a topic for another post, which we will cover in future articles. For now, we have no excuse not to implement libraries properly. However, my first recommendation (and paradoxically, the one I‚Äôve left for the end) is that, first and foremost, make sure the manufacturer doesn‚Äôt already provide an official library for their component. This is the fastest way to get a library up and running. Rest assured that the library provided by the manufacturer will likely follow a similar implementation to the one we have seen today, and our job will be to adapt the interface implementation part to our target or product.</p></section> <div class="w-[20px] h-[5px] bg-base-content mt-16 mb-4"></div><div class="flex gap-x-2 items-center"><div class="font-mono text-sm">Tags:</div><div class="badge badge-outline">firmware</div><div class="badge badge-outline">c</div><div class="badge badge-outline">development</div></div> </section> <aside class="col-span-1 md:col-span-4 lg:col-span-3" data-astro-cid-g3efgh6g> <section class="hidden md:block" data-astro-cid-g3efgh6g><div class="flex gap-x-2 mb-0 md:mb-16"><div class="badge badge-outline">firmware</div><div class="badge badge-outline">c</div><div class="badge badge-outline">development</div></div></section> <section class="hidden md:block sticky top-20" data-astro-cid-g3efgh6g> <h2 class="text-lg font-bold">Table of contents</h2><div class="divider mb-0 mt-0"></div><ul class="toc menu menu-md rounded-box gap-y-2"><li><a href="#isolating-the-library-from-the-target">Isolating the Library from the Target</a></li><li><a href="#declaring-the-library-api">Declaring the Library API</a></li><li><a href="#implementation-of-the-driver-api">Implementation of the Driver API</a></li><li><a href="#interface-declaration">Interface Declaration</a></li><li><a href="#other-aspects-to-consider">Other aspects to consider</a></li></ul><script>
  addIntersectionObserver();

  function addIntersectionObserver() {
    const observer = new IntersectionObserver((sections) => {
      sections.forEach((section) => {
        const heading = section.target.querySelector("h2");
        if (!heading) return;
        const id = heading.getAttribute("id");

        // Get the link to this section's heading
        const link = document.querySelector(`.toc li a[href="#${id}"]`);
        if (!link) return;

        // Add/remove the .active class based on whether the
        // section is visible
        const addRemove = section.intersectionRatio > 0 ? "add" : "remove";
        link.classList[addRemove]("active");
      });
    });

    document.querySelectorAll(".article-content section").forEach((section) => {
      observer.observe(section);
    });
  }
</script> </section> </aside> </div> </article>  </main> <footer class="footer bg-base-200 text-base-content p-10 mt-10"> <aside> <div class="flex-1 -ml-4"> <a class="btn btn-ghost text-xl" href="/en"><div> <span class="font-thin">the</span><span>Albert</span><span class="font-thin">Dev</span> </div></a> </div> </aside> <nav> <h6 class="footer-title">Explore</h6> <div class="flex flex-row gap-x-16"> <ul class="menu menu-vertical pl-0"> <li> <a class="-ml-4" href="/en">Home</a> </li> <li> <a class="-ml-4" href="/en/posts">Blog</a> </li> <!-- <li>
          <a class="-ml-4" href={translatePath("/publicaciones", lang)}
            >{t("nav.publications")}</a
          >
        </li>
        <li>
          <a class="-ml-4" href={translatePath("/acerca-de", lang)}
            >{t("nav.about")}</a
          >
        </li>
        <li>
          <a class="-ml-4" href={translatePath("/contactar", lang)}
            >{t("nav.contact")}</a
          >
        </li> --> </ul> </div> </nav> <nav> <h6 class="footer-title">Social media</h6> <ul class="menu menu-horizontal pl-0 -ml-4"> <li> <a target="_blank" href="https://linkedin.com/in/thealbertdev"> <svg width="24" height="24" viewBox="0 0 448 512" data-icon="fa6-brands:linkedin-in">  <use xlink:href="#ai:fa6-brands:linkedin-in"></use>  </svg> </a> </li> <li> <a target="_blank" href="https://github.com/TheAlbertDev"> <svg width="24" height="24" viewBox="0 0 496 512" data-icon="fa6-brands:github">  <symbol id="ai:fa6-brands:github"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6c-3.3.3-5.6-1.3-5.6-3.6c0-2 2.3-3.6 5.2-3.6c3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9c2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9c.3 2 2.9 3.3 5.9 2.6c2.9-.7 4.9-2.6 4.6-4.6c-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2c12.8 2.3 17.3-5.6 17.3-12.1c0-6.2-.3-40.4-.3-61.4c0 0-70 15-84.7-29.8c0 0-11.4-29.1-27.8-36.6c0 0-22.9-15.7 1.6-15.4c0 0 24.9 2 38.6 25.8c21.9 38.6 58.6 27.5 72.9 20.9c2.3-16 8.8-27.1 16-33.7c-55.9-6.2-112.3-14.3-112.3-110.5c0-27.5 7.6-41.3 23.6-58.9c-2.6-6.5-11.1-33.3 2.6-67.9c20.9-6.5 69 27 69 27c20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27c13.7 34.7 5.2 61.4 2.6 67.9c16 17.7 25.8 31.5 25.8 58.9c0 96.5-58.9 104.2-114.8 110.5c9.2 7.9 17 22.9 17 46.4c0 33.7-.3 75.4-.3 83.6c0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252C496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2c1.6 1.6 3.9 2.3 5.2 1c1.3-1 1-3.3-.7-5.2c-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9c1.6 1 3.6.7 4.3-.7c.7-1.3-.3-2.9-2.3-3.9c-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2c2.3 2.3 5.2 2.6 6.5 1c1.3-1.3.7-4.3-1.3-6.2c-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2c-1.4-2.3-4-3.3-5.6-2"/></symbol><use xlink:href="#ai:fa6-brands:github"></use>  </svg> </a> </li> <li> <a target="_blank" href="https://x.com/thealbertdev"> <svg width="24" height="24" viewBox="0 0 512 512" data-icon="fa6-brands:x-twitter">  <use xlink:href="#ai:fa6-brands:x-twitter"></use>  </svg> </a> </li> <li> <a target="_blank" href="https://orcid.org/0000-0001-5293-4487"> <svg width="24" height="24" viewBox="0 0 512 512" data-icon="fa6-brands:orcid">  <symbol id="ai:fa6-brands:orcid"><path fill="currentColor" d="M294.75 188.19h-45.92V342h47.47c67.62 0 83.12-51.34 83.12-76.91c0-41.64-26.54-76.9-84.67-76.9M256 8C119 8 8 119 8 256s111 248 248 248s248-111 248-248S393 8 256 8m-80.79 360.76h-29.84v-207.5h29.84zm-14.92-231.14a19.57 19.57 0 1 1 19.57-19.57a19.64 19.64 0 0 1-19.57 19.57M300 369h-81V161.26h80.6c76.73 0 110.44 54.83 110.44 103.85C410 318.39 368.38 369 300 369"/></symbol><use xlink:href="#ai:fa6-brands:orcid"></use>  </svg> </a> </li> </ul> </nav> </footer> </div> <div class="drawer-side" data-astro-cid-6unioc2r> <label for="my-drawer" aria-label="close sidebar" class="drawer-overlay block" data-astro-cid-6unioc2r></label> <div class="relative min-h-full bg-base-200" data-astro-cid-6unioc2r> <ul class="menu w-80 p-4 mt-12 text-lg" data-astro-cid-6unioc2r> <li data-astro-cid-6unioc2r><a href="/en" data-astro-cid-6unioc2r>Home</a></li> <li data-astro-cid-6unioc2r> <a href="/en/posts" data-astro-cid-6unioc2r>Blog</a> </li> <!-- <li>
        <a href={translatePath("/acerca-de", lang)}>{t("nav.about")}</a>
      </li>
      <li>
        <a href={translatePath("/contactar", lang)}>{t("nav.contact")}</a>
      </li> --> </ul> <label for="my-drawer" aria-label="close sidebar" class="absolute top-2 right-2 btn btn-square btn-ghost" data-astro-cid-6unioc2r> <svg width="24" height="24" viewBox="0 0 24 24" data-astro-cid-6unioc2r data-icon="mdi:close">  <symbol id="ai:mdi:close"><path fill="currentColor" d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"/></symbol><use xlink:href="#ai:mdi:close"></use>  </svg></label> </div> </div>  </div> </body></html> 